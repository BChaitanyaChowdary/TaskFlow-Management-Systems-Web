{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{useMutation,useQuery,useQueryClient}from'react-query';import{useAuth}from'../../contexts/AuthContext';import{projectsAPI}from'../../services/api';import Button from'../UI/Button';import Input from'../UI/Input';import{Send,MessageSquare,Users,Clock,Paperclip,Mic,Image,Video,FileText,X}from'lucide-react';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProjectChat=_ref=>{var _messagesResp$data;let{projectId,projectName}=_ref;const{user}=useAuth();const queryClient=useQueryClient();const[newMessage,setNewMessage]=useState('');const[isTyping,setIsTyping]=useState(false);const[attachment,setAttachment]=useState(null);const[recording,setRecording]=useState(false);const[showAttachmentOptions,setShowAttachmentOptions]=useState(false);const mediaRecorderRef=useRef(null);const messagesEndRef=useRef(null);const typingTimeoutRef=useRef(null);const[timeTick,setTimeTick]=useState(Date.now());// Fetch project messages with real-time updates\nconst{data:messagesResp,isLoading}=useQuery(['project-messages',projectId],()=>projectsAPI.getProjectMessages(projectId),{enabled:!!projectId,refetchInterval:2000,// Refresh every 2 seconds for real-time feel\nonError:error=>{console.error('Error fetching messages:',error);}});// Send message mutation\nconst sendMessageMutation=useMutation(messageData=>projectsAPI.createProjectMessage(projectId,messageData),{onSuccess:()=>{setNewMessage('');queryClient.invalidateQueries(['project-messages',projectId]);toast.success('Message sent!');},onError:error=>{var _error$response,_error$response$data,_error$response2,_error$response3;console.error('Send message error:',error);// Show specific error message\nif((_error$response=error.response)!==null&&_error$response!==void 0&&(_error$response$data=_error$response.data)!==null&&_error$response$data!==void 0&&_error$response$data.content){toast.error(error.response.data.content[0]||'Invalid message content');}else if(((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status)===403){toast.error('You must be a project member to send messages');}else if(((_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status)===400){toast.error('Invalid message. Please check your input.');}else{toast.error('Failed to send message. Please try again.');}}});// Auto-scroll to bottom when new messages arrive\nuseEffect(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},[messagesResp]);// Re-render periodically so relative times stay accurate\nuseEffect(()=>{const interval=setInterval(()=>setTimeTick(Date.now()),30000);// every 30s\nreturn()=>clearInterval(interval);},[]);// Normalize response\nconst messages=Array.isArray(messagesResp)?messagesResp:Array.isArray(messagesResp===null||messagesResp===void 0?void 0:messagesResp.data)?messagesResp.data:(messagesResp===null||messagesResp===void 0?void 0:(_messagesResp$data=messagesResp.data)===null||_messagesResp$data===void 0?void 0:_messagesResp$data.results)||[];const handleSendMessage=e=>{e.preventDefault();if(!newMessage.trim()&&!attachment)return;const messageData={content:newMessage.trim()||(attachment?\"[\".concat(getAttachmentType(attachment),\"]\"):'')};// For now, just send the message without attachment until backend supports it\n// TODO: Implement file upload when backend is ready\nif(attachment){console.log('Attachment selected:',attachment.name,attachment.type);const attachmentType=getAttachmentType(attachment);const emoji=getAttachmentEmoji(attachment);messageData.content=\"\".concat(emoji,\" \").concat(attachmentType,\": \").concat(attachment.name);}console.log('Sending message:',messageData);sendMessageMutation.mutate(messageData);setAttachment(null);setShowAttachmentOptions(false);};const getAttachmentType=file=>{if(file.type.includes('audio'))return'Voice message';if(file.type.includes('video'))return'Video';if(file.type.includes('image'))return'Image';if(file.type.includes('pdf'))return'PDF';return'File';};const getAttachmentEmoji=file=>{if(file.type.includes('audio'))return'ðŸŽ¤';if(file.type.includes('video'))return'ðŸŽ¥';if(file.type.includes('image'))return'ðŸ–¼ï¸';if(file.type.includes('pdf'))return'ðŸ“„';return'ðŸ“Ž';};const handleFileSelect=fileType=>{const input=document.createElement('input');input.type='file';switch(fileType){case'image':input.accept='image/*';break;case'video':input.accept='video/*';break;case'pdf':input.accept='.pdf';break;case'audio':input.accept='audio/*';break;default:input.accept='*';}input.onchange=e=>{var _e$target$files;const file=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0];if(file){setAttachment(file);setShowAttachmentOptions(false);}};input.click();};const handleTyping=e=>{setNewMessage(e.target.value);// Clear existing timeout\nif(typingTimeoutRef.current){clearTimeout(typingTimeoutRef.current);}// Set typing indicator\nsetIsTyping(true);// Clear typing indicator after 1 second of no typing\ntypingTimeoutRef.current=setTimeout(()=>{setIsTyping(false);},1000);};const formatMessageTime=timestamp=>{// Ensure we use the actual message time; timeTick is referenced so this recomputes periodically\nvoid timeTick;// referenced to trigger re-render\nconst date=new Date(timestamp);const now=new Date();const diffMs=now-date;const diffSec=Math.floor(diffMs/1000);const diffMin=Math.floor(diffSec/60);const diffHr=Math.floor(diffMin/60);const diffDay=Math.floor(diffHr/24);if(diffSec<10)return'Just now';if(diffSec<60)return\"\".concat(diffSec,\"s ago\");if(diffMin<60)return\"\".concat(diffMin,\"m ago\");if(diffHr<24)return\"\".concat(diffHr,\"h ago\");if(diffDay===1)return\"Yesterday \".concat(date.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}));return date.toLocaleDateString([],{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});};const isMyMessage=message=>{return message.author===(user===null||user===void 0?void 0:user.id);};if(isLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center p-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col h-full bg-white rounded-lg border border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-2 bg-blue-600 rounded-lg\",children:/*#__PURE__*/_jsx(MessageSquare,{className:\"h-5 w-5 text-white\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-bold text-gray-900 text-lg\",children:\"Project Chat\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-blue-600 font-medium\",children:projectName})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-sm text-gray-600 bg-white px-3 py-1 rounded-full\",children:[/*#__PURE__*/_jsx(Users,{className:\"h-4 w-4\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[(messages===null||messages===void 0?void 0:messages.length)||0,\" messages\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto p-4 space-y-4 min-h-[300px] max-h-[400px]\",children:[messages&&messages.length>0?messages.map(message=>/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(isMyMessage(message)?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-[70%] rounded-2xl px-4 py-3 shadow-sm \".concat(isMyMessage(message)?'bg-gradient-to-r from-blue-600 to-blue-700 text-white':'bg-gradient-to-r from-gray-100 to-gray-50 text-gray-900 border border-gray-200'),children:[!isMyMessage(message)&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-medium mb-1 opacity-75\",children:message.author_name||'Unknown User'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm whitespace-pre-wrap\",children:message.content}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs mt-1 flex items-center gap-1 \".concat(isMyMessage(message)?'text-blue-100':'text-gray-500'),children:isMyMessage(message)?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-green-300\",children:\"\\u2713\\u2713\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"Delivered\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2\",children:formatMessageTime(message.created_at)})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Clock,{className:\"h-3 w-3\"}),/*#__PURE__*/_jsx(\"span\",{children:formatMessageTime(message.created_at)})]})})]})},message.id)):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 text-gray-500\",children:[/*#__PURE__*/_jsx(MessageSquare,{className:\"h-12 w-12 mx-auto mb-4 text-gray-300\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"No messages yet\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-400\",children:\"Start the conversation!\"})]}),isTyping&&/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-start\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-100 rounded-lg px-4 py-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\",style:{animationDelay:'0.1s'}}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\",style:{animationDelay:'0.2s'}})]}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-500 ml-2\",children:\"Someone is typing...\"})]})})}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border-t border-gray-200 bg-gradient-to-r from-gray-50 to-blue-50\",children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,className:\"flex gap-3 items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"inline-flex items-center justify-center w-10 h-10 rounded-md border border-gray-300 bg-white hover:bg-gray-100\",onClick:()=>setShowAttachmentOptions(!showAttachmentOptions),title:\"Attach file\",children:/*#__PURE__*/_jsx(Paperclip,{className:\"h-4 w-4 text-gray-600\"})}),showAttachmentOptions&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute bottom-12 left-0 bg-white border border-gray-200 rounded-lg shadow-lg p-2 z-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-2\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-100 rounded\",onClick:()=>handleFileSelect('image'),children:[/*#__PURE__*/_jsx(Image,{className:\"h-4 w-4 text-blue-600\"}),\"Image\"]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-100 rounded\",onClick:()=>handleFileSelect('video'),children:[/*#__PURE__*/_jsx(Video,{className:\"h-4 w-4 text-purple-600\"}),\"Video\"]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-100 rounded\",onClick:()=>handleFileSelect('pdf'),children:[/*#__PURE__*/_jsx(FileText,{className:\"h-4 w-4 text-red-600\"}),\"PDF\"]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-100 rounded\",onClick:()=>handleFileSelect('audio'),children:[/*#__PURE__*/_jsx(Mic,{className:\"h-4 w-4 text-green-600\"}),\"Audio\"]})]})})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"inline-flex items-center justify-center w-10 h-10 rounded-md border \".concat(recording?'border-red-400 bg-red-50':'border-gray-300 bg-white',\" hover:bg-gray-100\"),onClick:async()=>{try{if(!recording){const stream=await navigator.mediaDevices.getUserMedia({audio:true});const recorder=new MediaRecorder(stream);const chunks=[];recorder.ondataavailable=e=>chunks.push(e.data);recorder.onstop=()=>{const blob=new Blob(chunks,{type:'audio/webm'});const file=new File([blob],\"voice-message-\".concat(Date.now(),\".webm\"),{type:'audio/webm'});setAttachment(file);stream.getTracks().forEach(t=>t.stop());};mediaRecorderRef.current=recorder;recorder.start();setRecording(true);toast.success('Recording started...');}else{var _mediaRecorderRef$cur;(_mediaRecorderRef$cur=mediaRecorderRef.current)===null||_mediaRecorderRef$cur===void 0?void 0:_mediaRecorderRef$cur.stop();setRecording(false);toast.success('Recording stopped');}}catch(err){toast.error('Microphone access denied');}},title:recording?'Stop Recording':'Record Voice Message',children:/*#__PURE__*/_jsx(Mic,{className:\"h-4 w-4 \".concat(recording?'text-red-500':'text-gray-600')})}),/*#__PURE__*/_jsx(Input,{value:newMessage,onChange:handleTyping,placeholder:\"Type your message...\",className:\"flex-1 rounded-full border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200\",disabled:sendMessageMutation.isLoading}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:!newMessage.trim()&&!attachment||sendMessageMutation.isLoading,loading:sendMessageMutation.isLoading,className:\"px-6 py-2 rounded-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 shadow-lg hover:shadow-xl transition-all duration-200\",children:/*#__PURE__*/_jsx(Send,{className:\"h-4 w-4\"})})]}),attachment&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 p-2 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-blue-700\",children:[getAttachmentEmoji(attachment),\" \",getAttachmentType(attachment),\": \",attachment.name]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-blue-500\",children:[\"(\",Math.round(attachment.size/1024),\" KB)\"]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setAttachment(null),className:\"text-blue-500 hover:text-blue-700\",children:/*#__PURE__*/_jsx(X,{className:\"h-4 w-4\"})})]}),recording&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 p-2 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-red-500 rounded-full animate-pulse\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-red-700\",children:\"Recording... Click mic to stop\"})]})]})]});};export default ProjectChat;","map":{"version":3,"names":["React","useState","useEffect","useRef","useMutation","useQuery","useQueryClient","useAuth","projectsAPI","Button","Input","Send","MessageSquare","Users","Clock","Paperclip","Mic","Image","Video","FileText","X","toast","jsx","_jsx","jsxs","_jsxs","ProjectChat","_ref","_messagesResp$data","projectId","projectName","user","queryClient","newMessage","setNewMessage","isTyping","setIsTyping","attachment","setAttachment","recording","setRecording","showAttachmentOptions","setShowAttachmentOptions","mediaRecorderRef","messagesEndRef","typingTimeoutRef","timeTick","setTimeTick","Date","now","data","messagesResp","isLoading","getProjectMessages","enabled","refetchInterval","onError","error","console","sendMessageMutation","messageData","createProjectMessage","onSuccess","invalidateQueries","success","_error$response","_error$response$data","_error$response2","_error$response3","response","content","status","_messagesEndRef$curre","current","scrollIntoView","behavior","interval","setInterval","clearInterval","messages","Array","isArray","results","handleSendMessage","e","preventDefault","trim","concat","getAttachmentType","log","name","type","attachmentType","emoji","getAttachmentEmoji","mutate","file","includes","handleFileSelect","fileType","input","document","createElement","accept","onchange","_e$target$files","target","files","click","handleTyping","value","clearTimeout","setTimeout","formatMessageTime","timestamp","date","diffMs","diffSec","Math","floor","diffMin","diffHr","diffDay","toLocaleTimeString","hour","minute","toLocaleDateString","month","day","isMyMessage","message","author","id","className","children","length","map","author_name","created_at","style","animationDelay","ref","onSubmit","onClick","title","stream","navigator","mediaDevices","getUserMedia","audio","recorder","MediaRecorder","chunks","ondataavailable","push","onstop","blob","Blob","File","getTracks","forEach","t","stop","start","_mediaRecorderRef$cur","err","onChange","placeholder","disabled","loading","round","size"],"sources":["C:/Users/B Chaitanya Chowdary/Desktop/Task/frontend/src/components/Projects/ProjectChat.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useMutation, useQuery, useQueryClient } from 'react-query';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { projectsAPI } from '../../services/api';\r\nimport Button from '../UI/Button';\r\nimport Input from '../UI/Input';\r\nimport { Send, MessageSquare, Users, Clock, Paperclip, Mic, Image, Video, FileText, X } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst ProjectChat = ({ projectId, projectName }) => {\r\n  const { user } = useAuth();\r\n  const queryClient = useQueryClient();\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const [attachment, setAttachment] = useState(null);\r\n  const [recording, setRecording] = useState(false);\r\n  const [showAttachmentOptions, setShowAttachmentOptions] = useState(false);\r\n  const mediaRecorderRef = useRef(null);\r\n  const messagesEndRef = useRef(null);\r\n  const typingTimeoutRef = useRef(null);\r\n  const [timeTick, setTimeTick] = useState(Date.now());\r\n\r\n  // Fetch project messages with real-time updates\r\n  const { data: messagesResp, isLoading } = useQuery(\r\n    ['project-messages', projectId],\r\n    () => projectsAPI.getProjectMessages(projectId),\r\n    {\r\n      enabled: !!projectId,\r\n      refetchInterval: 2000, // Refresh every 2 seconds for real-time feel\r\n      onError: (error) => {\r\n        console.error('Error fetching messages:', error);\r\n      }\r\n    }\r\n  );\r\n\r\n  // Send message mutation\r\n  const sendMessageMutation = useMutation(\r\n    (messageData) => projectsAPI.createProjectMessage(projectId, messageData),\r\n    {\r\n      onSuccess: () => {\r\n        setNewMessage('');\r\n        queryClient.invalidateQueries(['project-messages', projectId]);\r\n        toast.success('Message sent!');\r\n      },\r\n      onError: (error) => {\r\n        console.error('Send message error:', error);\r\n        \r\n        // Show specific error message\r\n        if (error.response?.data?.content) {\r\n          toast.error(error.response.data.content[0] || 'Invalid message content');\r\n        } else if (error.response?.status === 403) {\r\n          toast.error('You must be a project member to send messages');\r\n        } else if (error.response?.status === 400) {\r\n          toast.error('Invalid message. Please check your input.');\r\n        } else {\r\n          toast.error('Failed to send message. Please try again.');\r\n        }\r\n      },\r\n    }\r\n  );\r\n\r\n  // Auto-scroll to bottom when new messages arrive\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messagesResp]);\r\n\r\n  // Re-render periodically so relative times stay accurate\r\n  useEffect(() => {\r\n    const interval = setInterval(() => setTimeTick(Date.now()), 30000); // every 30s\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  // Normalize response\r\n  const messages = Array.isArray(messagesResp)\r\n    ? messagesResp\r\n    : (Array.isArray(messagesResp?.data)\r\n        ? messagesResp.data\r\n        : (messagesResp?.data?.results || []));\r\n\r\n  const handleSendMessage = (e) => {\r\n    e.preventDefault();\r\n    if (!newMessage.trim() && !attachment) return;\r\n\r\n    const messageData = {\r\n      content: newMessage.trim() || (attachment ? `[${getAttachmentType(attachment)}]` : ''),\r\n    };\r\n    \r\n    // For now, just send the message without attachment until backend supports it\r\n    // TODO: Implement file upload when backend is ready\r\n    if (attachment) {\r\n      console.log('Attachment selected:', attachment.name, attachment.type);\r\n      const attachmentType = getAttachmentType(attachment);\r\n      const emoji = getAttachmentEmoji(attachment);\r\n      messageData.content = `${emoji} ${attachmentType}: ${attachment.name}`;\r\n    }\r\n    \r\n    console.log('Sending message:', messageData);\r\n    sendMessageMutation.mutate(messageData);\r\n    setAttachment(null);\r\n    setShowAttachmentOptions(false);\r\n  };\r\n\r\n  const getAttachmentType = (file) => {\r\n    if (file.type.includes('audio')) return 'Voice message';\r\n    if (file.type.includes('video')) return 'Video';\r\n    if (file.type.includes('image')) return 'Image';\r\n    if (file.type.includes('pdf')) return 'PDF';\r\n    return 'File';\r\n  };\r\n\r\n  const getAttachmentEmoji = (file) => {\r\n    if (file.type.includes('audio')) return 'ðŸŽ¤';\r\n    if (file.type.includes('video')) return 'ðŸŽ¥';\r\n    if (file.type.includes('image')) return 'ðŸ–¼ï¸';\r\n    if (file.type.includes('pdf')) return 'ðŸ“„';\r\n    return 'ðŸ“Ž';\r\n  };\r\n\r\n  const handleFileSelect = (fileType) => {\r\n    const input = document.createElement('input');\r\n    input.type = 'file';\r\n    \r\n    switch (fileType) {\r\n      case 'image':\r\n        input.accept = 'image/*';\r\n        break;\r\n      case 'video':\r\n        input.accept = 'video/*';\r\n        break;\r\n      case 'pdf':\r\n        input.accept = '.pdf';\r\n        break;\r\n      case 'audio':\r\n        input.accept = 'audio/*';\r\n        break;\r\n      default:\r\n        input.accept = '*';\r\n    }\r\n    \r\n    input.onchange = (e) => {\r\n      const file = e.target.files?.[0];\r\n      if (file) {\r\n        setAttachment(file);\r\n        setShowAttachmentOptions(false);\r\n      }\r\n    };\r\n    \r\n    input.click();\r\n  };\r\n\r\n  const handleTyping = (e) => {\r\n    setNewMessage(e.target.value);\r\n    \r\n    // Clear existing timeout\r\n    if (typingTimeoutRef.current) {\r\n      clearTimeout(typingTimeoutRef.current);\r\n    }\r\n    \r\n    // Set typing indicator\r\n    setIsTyping(true);\r\n    \r\n    // Clear typing indicator after 1 second of no typing\r\n    typingTimeoutRef.current = setTimeout(() => {\r\n      setIsTyping(false);\r\n    }, 1000);\r\n  };\r\n\r\n  const formatMessageTime = (timestamp) => {\r\n    // Ensure we use the actual message time; timeTick is referenced so this recomputes periodically\r\n    void timeTick; // referenced to trigger re-render\r\n    const date = new Date(timestamp);\r\n    const now = new Date();\r\n    const diffMs = now - date;\r\n    const diffSec = Math.floor(diffMs / 1000);\r\n    const diffMin = Math.floor(diffSec / 60);\r\n    const diffHr = Math.floor(diffMin / 60);\r\n    const diffDay = Math.floor(diffHr / 24);\r\n\r\n    if (diffSec < 10) return 'Just now';\r\n    if (diffSec < 60) return `${diffSec}s ago`;\r\n    if (diffMin < 60) return `${diffMin}m ago`;\r\n    if (diffHr < 24) return `${diffHr}h ago`;\r\n    if (diffDay === 1) return `Yesterday ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;\r\n    return date.toLocaleDateString([], { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });\r\n  };\r\n\r\n  const isMyMessage = (message) => {\r\n    return message.author === user?.id;\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center p-8\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-white rounded-lg border border-gray-200\">\r\n      {/* Chat Header */}\r\n      <div className=\"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <div className=\"p-2 bg-blue-600 rounded-lg\">\r\n            <MessageSquare className=\"h-5 w-5 text-white\" />\r\n          </div>\r\n          <div>\r\n            <h3 className=\"font-bold text-gray-900 text-lg\">Project Chat</h3>\r\n            <p className=\"text-sm text-blue-600 font-medium\">{projectName}</p>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center gap-2 text-sm text-gray-600 bg-white px-3 py-1 rounded-full\">\r\n          <Users className=\"h-4 w-4\" />\r\n          <span className=\"font-medium\">{messages?.length || 0} messages</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Messages Area */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4 min-h-[300px] max-h-[400px]\">\r\n        {messages && messages.length > 0 ? (\r\n          messages.map((message) => (\r\n            <div\r\n              key={message.id}\r\n              className={`flex ${isMyMessage(message) ? 'justify-end' : 'justify-start'}`}\r\n            >\r\n              <div\r\n                className={`max-w-[70%] rounded-2xl px-4 py-3 shadow-sm ${\r\n                  isMyMessage(message)\r\n                    ? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white'\r\n                    : 'bg-gradient-to-r from-gray-100 to-gray-50 text-gray-900 border border-gray-200'\r\n                }`}\r\n              >\r\n                {!isMyMessage(message) && (\r\n                  <div className=\"text-xs font-medium mb-1 opacity-75\">\r\n                    {message.author_name || 'Unknown User'}\r\n                  </div>\r\n                )}\r\n                <p className=\"text-sm whitespace-pre-wrap\">{message.content}</p>\r\n                <div className={`text-xs mt-1 flex items-center gap-1 ${\r\n                  isMyMessage(message) ? 'text-blue-100' : 'text-gray-500'\r\n                }`}>\r\n                  {isMyMessage(message) ? (\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <span className=\"text-green-300\">âœ“âœ“</span>\r\n                      <span className=\"text-xs\">Delivered</span>\r\n                      <span className=\"ml-2\">{formatMessageTime(message.created_at)}</span>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Clock className=\"h-3 w-3\" />\r\n                      <span>{formatMessageTime(message.created_at)}</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))\r\n        ) : (\r\n          <div className=\"text-center py-8 text-gray-500\">\r\n            <MessageSquare className=\"h-12 w-12 mx-auto mb-4 text-gray-300\" />\r\n            <p className=\"text-sm\">No messages yet</p>\r\n            <p className=\"text-xs text-gray-400\">Start the conversation!</p>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Typing Indicator */}\r\n        {isTyping && (\r\n          <div className=\"flex justify-start\">\r\n            <div className=\"bg-gray-100 rounded-lg px-4 py-2\">\r\n              <div className=\"flex items-center gap-1\">\r\n                <div className=\"flex space-x-1\">\r\n                  <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"></div>\r\n                  <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\r\n                  <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\r\n                </div>\r\n                <span className=\"text-xs text-gray-500 ml-2\">Someone is typing...</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* Message Input */}\r\n      <div className=\"p-4 border-t border-gray-200 bg-gradient-to-r from-gray-50 to-blue-50\">\r\n        <form onSubmit={handleSendMessage} className=\"flex gap-3 items-center\">\r\n          {/* Attachment Options Dropdown */}\r\n          <div className=\"relative\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"inline-flex items-center justify-center w-10 h-10 rounded-md border border-gray-300 bg-white hover:bg-gray-100\"\r\n              onClick={() => setShowAttachmentOptions(!showAttachmentOptions)}\r\n              title=\"Attach file\"\r\n            >\r\n              <Paperclip className=\"h-4 w-4 text-gray-600\" />\r\n            </button>\r\n            \r\n            {showAttachmentOptions && (\r\n              <div className=\"absolute bottom-12 left-0 bg-white border border-gray-200 rounded-lg shadow-lg p-2 z-10\">\r\n                <div className=\"grid grid-cols-2 gap-2\">\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-100 rounded\"\r\n                    onClick={() => handleFileSelect('image')}\r\n                  >\r\n                    <Image className=\"h-4 w-4 text-blue-600\" />\r\n                    Image\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-100 rounded\"\r\n                    onClick={() => handleFileSelect('video')}\r\n                  >\r\n                    <Video className=\"h-4 w-4 text-purple-600\" />\r\n                    Video\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-100 rounded\"\r\n                    onClick={() => handleFileSelect('pdf')}\r\n                  >\r\n                    <FileText className=\"h-4 w-4 text-red-600\" />\r\n                    PDF\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-100 rounded\"\r\n                    onClick={() => handleFileSelect('audio')}\r\n                  >\r\n                    <Mic className=\"h-4 w-4 text-green-600\" />\r\n                    Audio\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Voice Recording Button */}\r\n          <button\r\n            type=\"button\"\r\n            className={`inline-flex items-center justify-center w-10 h-10 rounded-md border ${recording ? 'border-red-400 bg-red-50' : 'border-gray-300 bg-white'} hover:bg-gray-100`}\r\n            onClick={async () => {\r\n              try {\r\n                if (!recording) {\r\n                  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n                  const recorder = new MediaRecorder(stream);\r\n                  const chunks = [];\r\n                  recorder.ondataavailable = (e) => chunks.push(e.data);\r\n                  recorder.onstop = () => {\r\n                    const blob = new Blob(chunks, { type: 'audio/webm' });\r\n                    const file = new File([blob], `voice-message-${Date.now()}.webm`, { type: 'audio/webm' });\r\n                    setAttachment(file);\r\n                    stream.getTracks().forEach(t => t.stop());\r\n                  };\r\n                  mediaRecorderRef.current = recorder;\r\n                  recorder.start();\r\n                  setRecording(true);\r\n                  toast.success('Recording started...');\r\n                } else {\r\n                  mediaRecorderRef.current?.stop();\r\n                  setRecording(false);\r\n                  toast.success('Recording stopped');\r\n                }\r\n              } catch (err) {\r\n                toast.error('Microphone access denied');\r\n              }\r\n            }}\r\n            title={recording ? 'Stop Recording' : 'Record Voice Message'}\r\n          >\r\n            <Mic className={`h-4 w-4 ${recording ? 'text-red-500' : 'text-gray-600'}`} />\r\n          </button>\r\n\r\n          <Input\r\n            value={newMessage}\r\n            onChange={handleTyping}\r\n            placeholder=\"Type your message...\"\r\n            className=\"flex-1 rounded-full border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200\"\r\n            disabled={sendMessageMutation.isLoading}\r\n          />\r\n          \r\n          <Button\r\n            type=\"submit\"\r\n            disabled={(!newMessage.trim() && !attachment) || sendMessageMutation.isLoading}\r\n            loading={sendMessageMutation.isLoading}\r\n            className=\"px-6 py-2 rounded-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 shadow-lg hover:shadow-xl transition-all duration-200\"\r\n          >\r\n            <Send className=\"h-4 w-4\" />\r\n          </Button>\r\n        </form>\r\n\r\n        {/* Attachment Preview */}\r\n        {attachment && (\r\n          <div className=\"mt-2 p-2 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"text-sm text-blue-700\">\r\n                {getAttachmentEmoji(attachment)} {getAttachmentType(attachment)}: {attachment.name}\r\n              </span>\r\n              <span className=\"text-xs text-blue-500\">\r\n                ({Math.round(attachment.size / 1024)} KB)\r\n              </span>\r\n            </div>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setAttachment(null)}\r\n              className=\"text-blue-500 hover:text-blue-700\"\r\n            >\r\n              <X className=\"h-4 w-4\" />\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Recording Indicator */}\r\n        {recording && (\r\n          <div className=\"mt-2 p-2 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2\">\r\n            <div className=\"w-2 h-2 bg-red-500 rounded-full animate-pulse\"></div>\r\n            <span className=\"text-sm text-red-700\">Recording... Click mic to stop</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProjectChat;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}